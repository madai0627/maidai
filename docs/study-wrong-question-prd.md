## 文档信息

- **文档名称**：学习模块错题复习与做题记录功能 PRD
- **版本号**：V1.0
- **撰写人**：（待填）
- **创建日期**：（待填）
- **所属项目**：前台学习模块
- **状态**：草稿

---

## 一、背景与目标

### 1.1 产品背景

- 当前学习模块已支持：基础做题（练习/考试/作业）、题库导入等能力。
- 学生在日常使用中，错误的题目只存在于一次次练习/考试的记录里，缺乏集中管理与复习机制。
- 学生对自身学习情况（正确率趋势、薄弱知识点）缺乏直观的数据反馈，不利于持续学习和针对性提升。

### 1.2 问题与痛点

- **错题管理缺失**：错题分散在各次练习中，学生无法方便地查找和集中复习。
- **学习效果不可见**：缺少做题记录与趋势图表，学生难以判断自己是进步还是退步。
- **缺少针对性练习**：没有基于错题和知识点的针对性复习入口。

### 1.3 目标与衡量指标

- **目标**
  - 为学生提供「错题本」能力，用于集中管理并复习错题。
  - 提供「做题记录列表 + 详情」，让学生能回顾做题历史。
  - 提供基础「做题数据统计图表」，让学生直观感知自己的学习趋势和薄弱点。

- **衡量指标（示例，可按实际调整）**
  - 上线后 1 个月内，至少 **X%** 的活跃学生使用过错题复习功能。
  - 学习模块日活 / 人均访问次数提升 **Y%**。
  - 使用错题复习功能的学生，在目标科目的平均正确率提升 **Z%**（根据数据可得性评估）。

---

## 二、范围说明

### 2.1 本期范围（In Scope）

- 前台学习模块新增：
  - 「错题复习」能力（错题收集、错题列表、错题练习、掌握状态管理）。
  - 「做题记录列表」与「做题记录详情」页面。
  - 「做题数据图表」：学习模块首页概览 + 独立统计页面。

### 2.2 非本期范围（Out of Scope）

- 教师端 / 家长端的监控大屏与报表。
- 智能推荐策略、自适应学习路径等高级功能。
- 复杂导出报表、打印等功能。
- 跨用户维度的对比数据（如班级排名）。

---

## 三、用户与场景

### 3.1 用户角色

- **核心用户**
  - 学生（K12 / 大学生等，根据项目目标人群细化）。

- **次要用户**
  - 老师 / 家长（本期仅间接受益，不设计专用前台页面）。

### 3.2 典型用户故事（User Story）

1. **错题复习场景**
   - 作为一名学生，我在完成一套试卷后，希望系统能自动收集我做错的题，并在「错题本」中集中展示，方便之后单独复习。

2. **主动查缺补漏场景**
   - 作为一名学生，我希望在有空的时候可以进入「错题复习」页面，按科目/知识点筛选错题，用几分钟时间刷完几道错题，逐步补齐薄弱点。

3. **做题记录回顾场景**
   - 作为一名学生，我希望查看最近一段时间的做题记录，看到每次的正确率、得分、用时等，以便了解自己近期是否在进步。

4. **学习数据图表场景**
   - 作为一名学生，我希望通过图表看到自己在不同时间段、不同科目/知识点上的表现，以便更有针对性地安排复习。

---

## 四、功能需求

### 4.1 错题复习功能

#### 4.1.1 错题收集与管理

- **F-4.1.1-01 自动收集错题**
  - 在学生完成一套练习/考试/作业并提交后，系统自动遍历本次作答记录，将所有错误题目记录为「错题」。
- **F-4.1.1-02 去重合并逻辑**
  - 对同一学生的同一题目，只保留一条错题记录；
  - 同一题多次答错时，累加 `wrong_count`，更新 `last_wrong_time`。
- **F-4.1.1-03 错题基础字段**
  - 每条错题需至少记录：`user_id`、`question_id`、`first_wrong_time`、`last_wrong_time`、`wrong_count`、`status`、`subject_code`、`knowledge_codes` 等。
- **F-4.1.1-04 错题是否计入规则**
  - 部分题型可配置是否计入错题本（例如主观题、简答题可由业务决定）。

#### 4.1.2 错题列表页

- **F-4.1.2-01 入口**
  - 在学习模块首页展示「错题复习」入口卡片；
  - 在个人中心可增加「错题复习」入口（如适合）。
- **F-4.1.2-02 列表展示**
  - 每条错题行展示内容：
    - 题目摘要（题干前若干字）；
    - 科目、主要知识点名称；
    - 错误次数、最近错误时间；
    - 掌握状态（未复习/复习中/已掌握）。
- **F-4.1.2-03 筛选与排序**
  - 支持筛选条件：
    - 科目；
    - 知识点（单选/多选，至少支持单选）；
    - 时间范围（最近7天/30天/全部）；
    - 题型、难度（可选）。
  - 支持排序规则：
    - 按最近错误时间；
    - 按错误次数；
    - 按掌握状态。

#### 4.1.3 错题练习模式

- **F-4.1.3-01 生成练习题组**
  - 学生可以：
    - 勾选列表中多题后，点击「开始练习」；
    - 或不勾选，直接按条件生成「N 道错题小练习」（默认 10 道，可配置）。
- **F-4.1.3-02 练习页面能力**
  - 支持常规做题交互：
    - 展示题干、选项/答题区；
    - 提交当前题目的答案；
    - 查看标准答案与解析；
    - 上一题 / 下一题切换；
    - 进度条（例如：3/10）。
- **F-4.1.3-03 结果回写**
  - 学生在错题练习中再次作答的正确/错误情况，需要回写到错题记录（`correct_after_wrong_count` 等），用于后续掌握度判断。

#### 4.1.4 错题掌握状态管理

- **F-4.1.4-01 状态定义**
  - 错题状态枚举：
    - 0：未复习；
    - 1：复习中；
    - 2：已掌握。
- **F-4.1.4-02 手动标记**
  - 学生可在错题列表中勾选若干题，批量标记状态（如「已掌握」）。
- **F-4.1.4-03 自动规则（可选）**
  - 提供自动建议逻辑（例如）：
    - 若某题在最近 N 次练习中均答对，则可在UI中提示「建议标记为已掌握」。
  - 具体规则可配置，并在后端计算。

---

### 4.2 做题记录功能

#### 4.2.1 做题记录生成

- **F-4.2.1-01 会话级记录**
  - 每次学生完成一套题（练习/考试/作业）并提交后，生成一条做题记录 `exercise_record`。
- **F-4.2.1-02 明细级记录**
  - 同时，为本次做题中的每道题生成一条 `exercise_record_item`，记录单题作答结果。

#### 4.2.2 做题记录列表页

- **F-4.2.2-01 入口**
  - 学习模块首页的「更多」或个人中心增加「做题记录」入口。
- **F-4.2.2-02 列表展示**
  - 每条记录展示：
    - 时间（开始时间或结束时间）；
    - 标题（来源名称：某套卷/某次考试名称）；
    - 科目（如有）；
    - 题目总数；
    - 正确数 / 错误数；
    - 正确率；
    - 得分（如有）。
- **F-4.2.2-03 筛选与排序**
  - 支持按科目、来源类型（练习/考试/作业）、时间范围筛选；
  - 支持按时间、正确率、得分排序。

#### 4.2.3 做题记录详情页

- **F-4.2.3-01 概览信息**
  - 页面顶部展示本次记录的概览：
    - 名称（来源名称）；
    - 科目；
    - 开始/结束时间；
    - 总用时；
    - 题量；
    - 正确率；
    - 得分。
- **F-4.2.3-02 题目列表**
  - 展示本次所有题目：
    - 标明对/错；
    - 显示题目摘要；
    - 可点击进入单题解析/回看题干；
    - 对错误题目可快捷加入或查看错题本状态。
- **F-4.2.3-03 小图表（可选，增强）**
  - 简易统计信息（可后置）：
    - 本次试卷的知识点分布柱状图；
    - 题型分布饼图。

---

### 4.3 做题数据统计图表

#### 4.3.1 学习模块首页概览

- **F-4.3.1-01 概览卡片**
  - 展示近期概要信息：
    - 最近 7 天或 30 天完成的做题次数；
    - 总题量；
    - 平均正确率；
    - 与上一周期比较的涨跌。
- **F-4.3.1-02 小图表**
  - 折线图：最近 7 天/30 天的每日正确率。
  - 文本列表：当前最薄弱知识点 TOP3（名称 + 正确率）。

#### 4.3.2 学习统计页面（详细）

- **F-4.3.2-01 趋势图**
  - 按时间维度（天/周）展示整体正确率或平均得分趋势曲线。
- **F-4.3.2-02 科目/知识点分布**
  - 柱状图：按科目或主要知识点展示正确率或错题数量。
- **F-4.3.2-03 题型分布**
  - 饼图/环形图：展示不同题型的做题数量及正确率。
- **F-4.3.2-04 时间范围选择**
  - 支持最近 7 天、30 天、自定义时间区间。

---

## 五、数据与接口设计（概要）

> 以下为逻辑模型与接口字段概要，具体表结构与字段类型可由后端根据技术栈落地。

### 5.1 数据模型（逻辑）

#### 5.1.1 错题记录表 `wrong_question`

- 核心字段：
  - `id`、`user_id`、`question_id`
  - `first_wrong_time`、`last_wrong_time`
  - `wrong_count`、`correct_after_wrong_count`
  - `status`（0 未复习 / 1 复习中 / 2 已掌握）
  - `subject_code`、`knowledge_codes`（JSON 数组）
  - `question_type`、`difficulty`
  - `last_source_type`、`last_source_id`
  - `is_deleted`、`created_at`、`updated_at`
- 索引建议：
  - 唯一索引：`(user_id, question_id)`
  - 查询索引：`(user_id, subject_code, status)`、`(user_id, last_wrong_time)` 等。

#### 5.1.2 做题记录表 `exercise_record`

- 主要字段：
  - `id`、`user_id`
  - `source_type`、`source_id`、`subject_code`
  - `start_time`、`end_time`、`duration_seconds`
  - `total_count`、`correct_count`、`wrong_count`
  - `score`、`max_score`、`accuracy`
  - `device_type`、`extra`
  - `is_deleted`、`created_at`、`updated_at`

#### 5.1.3 做题记录明细表 `exercise_record_item`

- 主要字段：
  - `id`、`record_id`、`user_id`
  - `question_id`、`subject_code`、`knowledge_codes`
  - `question_type`
  - `is_correct`、`score`、`max_score`
  - `duration_seconds`、`submit_time`
  - `is_marked_wrong`
  - `created_at`、`updated_at`

---

### 5.2 接口（REST 示例）

#### 5.2.1 错题相关接口

- **获取错题列表**
  - `GET /api/wrong-questions`
  - 功能：分页查询当前登录用户的错题列表，支持筛选/排序。

- **批量更新错题状态**
  - `POST /api/wrong-questions/status`
  - 功能：学生手动批量标记错题状态（如标记为已掌握）。

- **生成错题练习题组**
  - `POST /api/wrong-questions/practice`
  - 功能：根据条件生成一组错题 ID，用于进入做题。

#### 5.2.2 做题记录接口

- **获取做题记录列表**
  - `GET /api/exercise-records`
  - 功能：按条件分页查询学生的做题记录历史。

- **获取做题记录详情**
  - `GET /api/exercise-records/{id}`
  - 功能：查看某次做题记录详情（会话 + 题目级）。

#### 5.2.3 统计接口

- **学习概览**
  - `GET /api/stats/learning-overview`
  - 功能：用于学习模块首页的概览卡片和小图表。

- **详细统计**
  - `GET /api/stats/learning-detail`
  - 功能：用于学习统计页面的各类图表数据。

> 详细字段示例可在接口文档中进一步拆分（如 Swagger / YApi 上维护）。

---

## 六、前端设计

> 以下为前端页面/路由与组件拆分设计，可根据实际技术栈（如 React/Vue）实现。

### 6.1 路由与页面结构

假设学习模块主路由为 `/study`：

- **`/study`**：学习模块首页
  - 模块入口卡片：
    - 「继续学习」
    - 「错题复习」 → `/study/wrong-questions`
    - 「做题记录」 → `/study/records`
    - 「学习数据」 → `/study/stats`
  - 概览小图表调用：`GET /api/stats/learning-overview`

- **`/study/wrong-questions`**：错题列表页
- **`/study/wrong-questions/practice`**：错题练习页面（可复用通用做题组件）
- **`/study/records`**：做题记录列表页
- **`/study/records/:id`**：做题记录详情页
- **`/study/stats`**：学习统计页面（详细图表）

### 6.2 页面与组件拆分

#### 6.2.1 学习首页 `StudyHome`

- **主要模块组件**
  - `StudyQuickEntry`：入口卡片区域（错题复习 / 做题记录 / 学习数据）。
  - `StudyOverviewCard`：概要信息展示（总做题量、平均正确率等）。
  - `StudyOverviewChart`：小的折线图 & 弱项知识点列表。

#### 6.2.2 错题列表页 `WrongQuestionListPage`

- **页面布局**
  - 顶部：筛选条 `WrongQuestionFilterBar`
  - 中部：列表 `WrongQuestionList`
  - 底部：分页 `Pagination`

- **主要组件**
  - `WrongQuestionFilterBar`
    - 筛选条件：科目选择、知识点选择、时间范围、题型、状态等；
    - 「重置」按钮。
  - `WrongQuestionList`
    - 列表行组件 `WrongQuestionItem`：
      - 展示题目摘要、错题次数、最近错误时间、知识点、状态；
      - 操作按钮：勾选 / 查看题目解析 / 标记为已掌握。
    - 顶部勾选 + 批量操作区域（批量标记状态、开始练习）。
  - `WrongQuestionPracticeEntry`
    - 提供「一键生成 N 道错题小练习」入口（调用 practice 接口）。

#### 6.2.3 错题练习页 `WrongQuestionPracticePage`

- **组件复用建议**
  - 若系统已有通用「做题页面组件」`ExercisePlayer`，可直接复用，只需在入口传入「错题题组」的 questionIds。
- **关键交互**
  - 每答完一题后：
    - 调用通用作答提交接口；
    - 同步写入 `exercise_record_item`；
    - 若为错题本练习，后端负责更新 `wrong_question` 相关统计与状态建议。

#### 6.2.4 做题记录列表页 `ExerciseRecordListPage`

- **组件**
  - `ExerciseRecordFilterBar`：科目、来源类型、时间范围筛选；
  - `ExerciseRecordList`：列表 + 行组件 `ExerciseRecordItem`；
    - 行元素：时间、名称、科目、正确率、得分、用时；
    - 点击跳转 `/study/records/:id`。
  - `Pagination`

#### 6.2.5 做题记录详情页 `ExerciseRecordDetailPage`

- **结构**
  - 顶部：本次做题概览卡片 `ExerciseRecordSummaryCard`；
  - 中部：题目列表 `ExerciseRecordQuestionList`；
  - 底部：可选小图表区域 `ExerciseRecordMiniStats`。

- **交互要点**
  - 点击某题行 → 弹出题目预览/解析弹窗（可复用通用题目展示组件 `QuestionPreview`）。
  - 若该题为错误题目：
    - 展示当前错题状态（未复习/复习中/已掌握）；
    - 提供「加入错题本」或「查看错题详情」按钮（若设计单独错题详情页）。

#### 6.2.6 学习统计页 `StudyStatsPage`

- **组件结构**
  - `StatsFilterBar`：时间范围、科目选择；
  - `AccuracyTrendChart`：正确率趋势折线图；
  - `SubjectDistributionChart`：科目/主要维度的柱状图；
  - `QuestionTypeChart`：题型分布饼图；
  - （可选）`KnowledgeHeatmap`：知识点热力图（后续扩展）。

---

## 七、交互与体验设计

### 7.1 通用交互

- **加载与空状态**
  - 接口请求中展示骨架屏或加载中状态；
  - 当无数据时展示友好空状态文案，如：
    - 「你还没有产生错题，先去做几道题试试吧」；
    - 「最近一段时间还没有做题记录」。
- **异常提示**
  - 网络异常或服务器错误时，展示错误提示（如「加载失败，请稍后重试」）。

### 7.2 错题复习体验

- **错题数量较多时**
  - 引导用户按「知识点/科目」先筛选，避免列表过长；
  - 推荐「小练习」入口（如 10 道错题攻克）。
- **减少挫败感**
  - 在错题练习完成页面展示：
    - 本次练习的正确率；
    - 已攻克 X 道错题（如连续答对）。
  - 文案尽量正向鼓励，如「再接再厉」「已经比上次进步了」。

### 7.3 统计图表体验

- **移动端阅读性**
  - 控制图表数量与复杂度，每屏不堆叠过多图表；
  - 允许左右滑动或切换 Tab 方式展示不同维度的数据。
- **数据精度与展示**
  - 正确率保留 1~2 位小数；
  - 高亮明显的变化点或薄弱项（用颜色/标记）。

---

## 八、非功能需求

- **性能**
  - 常用查询（最近 30 天的错题列表、做题记录、统计图）需在正常网络环境下 **2 秒内** 返回。
- **安全**
  - 所有与学习数据相关的接口必须校验登录态；
  - 用户只能访问自己的错题、做题记录和统计数据。
- **可用性**
  - 界面布局简洁、元素命名清晰，尽可能复用现有 UI 标准组件。
- **可维护性**
  - 前后端接口需统一在接口文档系统中维护（如 Swagger / YApi），保持字段说明完整。

---

## 九、里程碑与实现优先级

### 9.1 阶段划分

- **阶段一（MVP，优先级 P0）**
  - 做题记录：`exercise_record` + `exercise_record_item` 生成逻辑；
  - 前台：做题记录列表 + 详情页；
  - 错题自动收集逻辑（生成 `wrong_question` 记录）；
  - 错题列表页（基础查询 + 筛选）。

- **阶段二（优先级 P1）**
  - 错题练习模式（错题题组生成 + 做题入口）；
  - 错题掌握状态管理（手动标记 + 自动建议规则雏形）；
  - 学习首页概览卡片与小图表。

- **阶段三（优先级 P2）**
  - 学习统计详细页面（多图表视图）；
  - 知识点维度更精细的统计（如热力图）；
  - 更复杂的自动掌握度算法与个性化推荐基础。

### 9.2 依赖与风险

- 依赖：
  - 题库系统需能提供题目摘要/完整题干和解析接口；
  - 用户体系与登录态已稳定。
- 风险：
  - 历史数据兼容问题：若历史数据不全，首次统计可能不准确；
  - 部分题型的判分逻辑复杂，可能影响错题判定精度。

---


